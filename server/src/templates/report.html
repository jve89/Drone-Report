<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>{{PROJECT}} — Inspection report</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root { --theme: {{THEME_COLOR}}; --fg:#0b1324; --muted:#64748b; --line:#e5e7eb; --shade:#f6f7fb; }
  * { box-sizing: border-box; }
  html, body { margin: 0; padding: 0; }
  body { font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif; color: var(--fg); background:#fff; }
  .container { width: 100%; max-width: 900px; margin: 0 auto; padding: 28px; }

  /* Type & tokens */
  h1 { font-size: 30px; margin: 6px 0 2px; line-height: 1.25; }
  h2 { font-size: 20px; margin: 0 0 12px; border-left: 4px solid var(--theme); padding-left: 8px; line-height: 1.3; }
  h3 { font-size: 16px; margin: 12px 0 6px; line-height: 1.35; }
  p { line-height: 1.55; margin: 8px 0; }
  .muted { color: var(--muted); }
  .small { font-size: 12px; }

  /* Pills */
  .badge { display: inline-block; padding: 2px 8px; font-size: 12px; border-radius: 999px; background: #F3F4F6; margin-right: 6px; border:1px solid var(--line);}
  .badge.warn { background: #FEF3C7; border-color:#fde68a; }
  .badge.info { background: #DBEAFE; border-color:#bfdbfe; }
  .chip { display: inline-block; padding: 2px 8px; font-size: 12px; border-radius: 999px; background: #F3F4F6; margin: 0 6px 6px 0; }
  .chip.muted { background: #F9FAFB; color: #6B7280; border: 1px solid #E5E7EB; }

  /* Cards / layout */
  .card { margin: 22px 0; padding: 16px; border: 1px solid var(--line); border-radius: 12px; background: #fff; }
  .grid.two { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .grid.detail { display: grid; grid-template-columns: 3fr 2fr; gap: 14px; align-items: start; }

  /* Cover */
  .cover { padding: 54px 0 26px; }
  .cover .top { display: grid; grid-template-columns: 120px 1fr; gap: 18px; align-items: center; }
  .cover .top > :first-child { width: 120px; height: 72px; display: flex; align-items: center; justify-content: center; border:1px solid var(--line); border-radius:10px; background:#fff; }
  .cover img.logo { display: block; max-width: 100%; max-height: 100%; height: auto; width: auto; object-fit: contain; }
  .cover .meta { color: #374151; margin-top: 4px; }
  .cover .counts { margin-top: 18px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
  .cover .count { border: 1px solid var(--line); border-radius: 12px; padding: 12px; text-align: center; background:#fff; }
  .cover .count .label { font-size: 12px; color: #6B7280; }
  .cover .count .value { font-size: 18px; font-weight: 600; margin-top: 4px; }
  .page-break { page-break-before: always; break-before: page; }

  /* Tables */
  table.kv { border-collapse: collapse; width: 100%; }
  table.kv th, table.kv td { font-size: 13px; text-align: left; padding: 6px 8px; border-bottom: 1px solid #F3F4F6; vertical-align: top; }

  table.overview { border-collapse: collapse; width: 100%; table-layout: fixed; border:1px solid var(--line); border-radius:10px; overflow:hidden; }
  table.overview th, table.overview td { font-size: 12px; text-align: left; padding: 7px 8px; border-bottom: 1px solid #E5E7EB; vertical-align: top; }
  table.overview th { background: #F9FAFB; font-weight: 600; }
  table.overview td, table.overview th { word-break: break-word; overflow-wrap: anywhere; }
  table.overview tr:nth-child(even) td { background: #FBFBFB; }

  /* Detail pages */
  .detail-card { border: 1px solid var(--line); border-radius: 12px; padding: 12px; background:#fff; page-break-inside: avoid; break-inside: avoid; }
  .detail-img { width: 100%; height: auto; object-fit: contain; border: 1px solid var(--line); border-radius: 10px; background:#fff; }
  .fact { margin: 6px 0; font-size: 13px; }
  .fact b { display:inline-block; min-width:110px; color:#334155; }

  /* Zoom tiles (ROIs) */
  .tiles { display:grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 12px; }
  .tile { border:1px solid var(--line); border-radius:10px; overflow:hidden; background:#fff; cursor:pointer; }
  .tile .frame { width:100%; height:160px; overflow:hidden; position:relative; background:#fff; }
  .tile .inner { position:absolute; top:0; left:0; }
  .tile .cap { padding:8px 10px; border-top:1px solid var(--line); font-size:12px; color:#334155; min-height:38px; }
  .tile .cap .id { font-weight:700; margin-right:6px; color:#111827; }
  .tile.placeholder { cursor:default; }
  .tile.placeholder .frame { display:grid; place-items:center; color:#94a3b8; font-size:13px; }
  .tile.placeholder .cap { color:#94a3b8; }

  /* Appendix */
  #media * { box-sizing: border-box; }
  #media figure { display: grid !important; grid-template-columns: 3fr 2fr !important; gap: 12px !important; align-items: start !important; margin: 0 !important; }
  #media figure > img { width: 100% !important; height: auto !important; object-fit: contain !important; border-radius: 6px !important; border:1px solid var(--line);}
  #media figure > figcaption { font-size: 11px !important; color: #6B7280 !important; margin: 0 !important; word-break: break-word !important; }
  #media .cell, #media .media-item, #media .appendix-item, #media figure { page-break-inside: avoid !important; break-inside: avoid !important; border: 1px solid var(--line); border-radius: 10px; padding: 8px; margin-bottom: 12px; background:#fff; }
  #media .cell:nth-of-type(3n), #media .media-item:nth-of-type(3n), #media .appendix-item:nth-of-type(3n), #media > *:nth-of-type(3n) { page-break-after: always !important; break-after: page !important; }
  #media img[style*="height"], #media .thumb, #media .cell img { height: auto !important; object-fit: contain !important; }

  footer { margin-top: 24px; padding-top: 12px; border-top: 1px solid var(--line); color: #6B7280; font-size: 12px; }
</style>
</head>
<body>
  <div class="container">
    {{COVER}}
    <div class="page-break"></div>

    {{SUMMARY}}

    <div class="card">
      <h2>Annotation overview</h2>
      {{OVERVIEW}}
    </div>

    {{METHODOLOGY}}

    <div class="card">
      <h2>Detailed annotations</h2>
      {{DETAIL_PAGES}}
    </div>

    <div class="card" id="media">
      <h2>Media appendix</h2>
      {{APPENDIX_PAGES}}
    </div>

    <div class="card">
      <h2>Compliance & Disclaimer</h2>
      {{COMPLIANCE}}
    </div>

    <footer>
      Generated by Drone Report. Theme color {{THEME_COLOR}}.
    </footer>
  </div>

  <!-- Preview→Editor bridge -->
  <script>
    document.addEventListener('click', function(e){
      const el = e.target instanceof Element ? e.target : null;
      if (!el) return;
      const t = el.closest('[data-dr-select]');
      if(!t) return;
      const page = t.getAttribute('data-dr-select') || '';
      const regionId = t.getAttribute('data-dr-region');
      try {
        window.parent && window.parent.postMessage(
          { type:'dr.select', page, regionId: regionId ? Number(regionId) : undefined },
          '*'
        );
      } catch {}
    }, {capture:true});
  </script>
</body>
</html>
